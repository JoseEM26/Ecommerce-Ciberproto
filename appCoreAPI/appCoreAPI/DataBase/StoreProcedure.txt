
USE CiberProtoDatabase
GO

-- =============================================
-- PROCEDIMIENTOS PARA USUARIO
-- =============================================

--listar usuarios
CREATE OR ALTER PROCEDURE usp_listarUsuario
AS
BEGIN
    SET NOCOUNT ON;

    SELECT 
        IdUsuario,
        Nombres,
        Apellidos,
        Correo,
        Telefono,
        Rol,
        Activo,
        FechaRegistro
    FROM tb_usuario;
END
GO

--registrar usuarios
CREATE OR ALTER PROCEDURE usp_registrarUsuario
    @Nombres   VARCHAR(255),
    @Apellidos VARCHAR(255),
    @Correo    VARCHAR(255),
    @Clave     VARCHAR(100),
    @Telefono  VARCHAR(20),
    @Rol       VARCHAR(20)
AS
BEGIN
    SET NOCOUNT ON;

    INSERT INTO tb_usuario (
        Nombres,
        Apellidos,
        Correo,
        Clave,
        Telefono,
        Rol
    )
    VALUES (
        @Nombres,
        @Apellidos,
        @Correo,
        @Clave,
        @Telefono,
        ISNULL(@Rol, 'CLIENTE')
    );
END
GO

--obtener usuario por id
CREATE OR ALTER PROCEDURE usp_obtenerUsuarioById
    @IdUsuario INT
AS
BEGIN
    SET NOCOUNT ON;

    SELECT 
        IdUsuario,
        Nombres,
        Apellidos,
        Correo,
        Telefono,
        Rol,
        Activo
    FROM tb_usuario
    WHERE IdUsuario = @IdUsuario;
END
GO

-- actualizar usuario
CREATE OR ALTER PROCEDURE usp_actualizarUsuario
    @IdUsuario INT,
    @Nombres   VARCHAR(255),
    @Apellidos VARCHAR(255),
    @Correo    VARCHAR(255),
    @Telefono  VARCHAR(20),
    @Activo    BIT
AS
BEGIN
    SET NOCOUNT ON;

    UPDATE tb_usuario
    SET
        Nombres   = @Nombres,
        Apellidos = @Apellidos,
        Correo    = @Correo,
        Telefono  = @Telefono,
        Activo    = @Activo
    WHERE IdUsuario = @IdUsuario;
END
GO

-- login
CREATE OR ALTER PROCEDURE usp_usuario_login
    @Correo VARCHAR(255),
    @Clave  VARCHAR(100)
AS
BEGIN
    SET NOCOUNT ON;

    SELECT 
        IdUsuario,
        Nombres,
        Apellidos,
        Correo,
        Rol
    FROM tb_usuario
    WHERE Correo = @Correo
      AND Clave  = @Clave
      AND Activo = 1;
END
GO